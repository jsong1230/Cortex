# F-07 í…”ë ˆê·¸ë¨ ë´‡ ëª…ë ¹ì–´ ì²˜ë¦¬ â€” í…ŒìŠ¤íŠ¸ ëª…ì„¸

**ë²„ì „**: 1.0 | **ë‚ ì§œ**: 2026-02-28 | **ìƒíƒœ**: í™•ì •
**ì°¸ì¡°**: design.md, docs/project/features.md #F-07

---

## ë‹¨ìœ„ í…ŒìŠ¤íŠ¸ (Unit Tests)

### U-07-01: parseCommand

| í…ŒìŠ¤íŠ¸ ID | ì…ë ¥ | ê¸°ëŒ€ ì¶œë ¥ |
|----------|------|----------|
| U-07-01-1 | `/good` | `{ command: 'good', args: [] }` |
| U-07-01-2 | `/bad` | `{ command: 'bad', args: [] }` |
| U-07-01-3 | `/save 3` | `{ command: 'save', args: ['3'] }` |
| U-07-01-4 | `/more` | `{ command: 'more', args: [] }` |
| U-07-01-5 | `/keyword LLM` | `{ command: 'keyword', args: ['LLM'] }` |
| U-07-01-6 | `/keyword React Server Components` | `{ command: 'keyword', args: ['React', 'Server', 'Components'] }` |
| U-07-01-7 | `/stats` | `{ command: 'stats', args: [] }` |
| U-07-01-8 | `/mute 3` | `{ command: 'mute', args: ['3'] }` |
| U-07-01-9 | `hello` (ëª…ë ¹ì–´ ì•„ë‹˜) | `null` |
| U-07-01-10 | `/` (ìŠ¬ë˜ì‹œë§Œ) | `null` |
| U-07-01-11 | `/GOOD` (ëŒ€ë¬¸ì) | `{ command: 'good', args: [] }` |
| U-07-01-12 | `  /good  ` (ê³µë°± í¬í•¨) | `{ command: 'good', args: [] }` |
| U-07-01-13 | `/good@CortexBot` (ë´‡ ëª…ì¹­ í¬í•¨) | `{ command: 'good', args: [] }` |

### U-07-02: handleGood

| í…ŒìŠ¤íŠ¸ ID | ì‹œë‚˜ë¦¬ì˜¤ | ê¸°ëŒ€ ë™ì‘ |
|----------|---------|----------|
| U-07-02-1 | ìµœì‹  ë¸Œë¦¬í•‘ ì¡´ì¬, ì•„ì´í…œ 3ê°œ | user_interactionsì— 3ê±´ INSERT, 'ì¢‹ì•„ìš”' í…ìŠ¤íŠ¸ ë°˜í™˜ |
| U-07-02-2 | ë¸Œë¦¬í•‘ ì—†ìŒ | "ì•„ì§ ë¸Œë¦¬í•‘ì´ ì—†ìŠµë‹ˆë‹¤" í…ìŠ¤íŠ¸ ë°˜í™˜ |
| U-07-02-3 | Supabase ì˜¤ë¥˜ | ì—ëŸ¬ë¥¼ throw í•˜ê±°ë‚˜ ì˜¤ë¥˜ ë©”ì‹œì§€ ë°˜í™˜ |

### U-07-03: handleBad

| í…ŒìŠ¤íŠ¸ ID | ì‹œë‚˜ë¦¬ì˜¤ | ê¸°ëŒ€ ë™ì‘ |
|----------|---------|----------|
| U-07-03-1 | ìµœì‹  ë¸Œë¦¬í•‘ ì¡´ì¬ | user_interactionsì— 'ì‹«ì–´ìš”' INSERT, í›„ì† ì§ˆë¬¸ í¬í•¨ ì‘ë‹µ ë°˜í™˜ |
| U-07-03-2 | ë¸Œë¦¬í•‘ ì—†ìŒ | "ì•„ì§ ë¸Œë¦¬í•‘ì´ ì—†ìŠµë‹ˆë‹¤" í…ìŠ¤íŠ¸ ë°˜í™˜ |

### U-07-04: handleSave

| í…ŒìŠ¤íŠ¸ ID | ì‹œë‚˜ë¦¬ì˜¤ | ê¸°ëŒ€ ë™ì‘ |
|----------|---------|----------|
| U-07-04-1 | ì˜¤ëŠ˜ ë¸Œë¦¬í•‘ ì¡´ì¬, N=1 ìœ íš¨ | user_interactionsì— 'ì €ì¥' INSERT, ì„±ê³µ ë©”ì‹œì§€ ë°˜í™˜ |
| U-07-04-2 | N=0 (ìœ íš¨í•˜ì§€ ì•Šì€ ë²ˆí˜¸) | "ìœ íš¨í•˜ì§€ ì•Šì€ ë²ˆí˜¸" ë©”ì‹œì§€ ë°˜í™˜ |
| U-07-04-3 | N=99 (ë²”ìœ„ ì´ˆê³¼) | "ìœ íš¨í•˜ì§€ ì•Šì€ ë²ˆí˜¸" ë©”ì‹œì§€ ë°˜í™˜ |
| U-07-04-4 | ì˜¤ëŠ˜ ë¸Œë¦¬í•‘ ì—†ìŒ | "ì˜¤ëŠ˜ ë¸Œë¦¬í•‘ì´ ì—†ìŠµë‹ˆë‹¤" ë©”ì‹œì§€ ë°˜í™˜ |
| U-07-04-5 | ìˆ«ìê°€ ì•„ë‹Œ ì¸ì (save abc) | "ìœ íš¨í•˜ì§€ ì•Šì€ ë²ˆí˜¸" ë©”ì‹œì§€ ë°˜í™˜ |

### U-07-05: handleMore

| í…ŒìŠ¤íŠ¸ ID | ì‹œë‚˜ë¦¬ì˜¤ | ê¸°ëŒ€ ë™ì‘ |
|----------|---------|----------|
| U-07-05-1 | ì •ìƒ í˜¸ì¶œ | ì˜¤ëŠ˜ ë‚ ì§œ ê¸°ë°˜ ì›¹ URL í¬í•¨ í…ìŠ¤íŠ¸ ë°˜í™˜ |
| U-07-05-2 | URL í˜•ì‹ | YYYY-MM-DD í˜•ì‹ì˜ ë‚ ì§œê°€ URLì— í¬í•¨ë¨ |

### U-07-06: handleKeyword

| í…ŒìŠ¤íŠ¸ ID | ì‹œë‚˜ë¦¬ì˜¤ | ê¸°ëŒ€ ë™ì‘ |
|----------|---------|----------|
| U-07-06-1 | ì‹ ê·œ í‚¤ì›Œë“œ "LLM" | interest_profile UPSERT í˜¸ì¶œ, ì„±ê³µ ë©”ì‹œì§€ ë°˜í™˜ |
| U-07-06-2 | ê¸°ì¡´ í‚¤ì›Œë“œ ì¬ì¶”ê°€ | UPSERTë¡œ ì¤‘ë³µ ì—†ì´ ì²˜ë¦¬ |
| U-07-06-3 | ë¹ˆ í‚¤ì›Œë“œ "" | "í‚¤ì›Œë“œë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”" ë©”ì‹œì§€ ë°˜í™˜ |

### U-07-07: handleStats

| í…ŒìŠ¤íŠ¸ ID | ì‹œë‚˜ë¦¬ì˜¤ | ê¸°ëŒ€ ë™ì‘ |
|----------|---------|----------|
| U-07-07-1 | ì´ë²ˆ ë‹¬ ë°˜ì‘ ì¡´ì¬ | í† í”½ Top 5 + ì•„í‹°í´ ìˆ˜ í¬í•¨ í…ìŠ¤íŠ¸ ë°˜í™˜ |
| U-07-07-2 | ë°˜ì‘ ì—†ìŒ | "ì´ë²ˆ ë‹¬ í†µê³„ê°€ ì•„ì§ ì—†ìŠµë‹ˆë‹¤" ë©”ì‹œì§€ ë°˜í™˜ |
| U-07-07-3 | ì‘ë‹µ í˜•ì‹ | ğŸ“Š, ğŸ”¥, ğŸ“š ì´ëª¨ì§€ í¬í•¨ |

### U-07-08: handleMute

| í…ŒìŠ¤íŠ¸ ID | ì‹œë‚˜ë¦¬ì˜¤ | ê¸°ëŒ€ ë™ì‘ |
|----------|---------|----------|
| U-07-08-1 | N=3 (3ì¼ ë®¤íŠ¸) | alert_settings UPSERT, "3ì¼ê°„ ì¤‘ë‹¨" ë©”ì‹œì§€ ë°˜í™˜ |
| U-07-08-2 | N=0 (ë®¤íŠ¸ í•´ì œ) | ë®¤íŠ¸ ë¹„í™œì„±í™”, "ì¬ê°œ" ë©”ì‹œì§€ ë°˜í™˜ |
| U-07-08-3 | ìˆ«ì ì•„ë‹Œ ì¸ì | "ìœ íš¨í•˜ì§€ ì•Šì€ ê°’" ë©”ì‹œì§€ ë°˜í™˜ |

### U-07-09: handleUnknown

| í…ŒìŠ¤íŠ¸ ID | ì‹œë‚˜ë¦¬ì˜¤ | ê¸°ëŒ€ ë™ì‘ |
|----------|---------|----------|
| U-07-09-1 | `/unknown` | ë„ì›€ë§ í…ìŠ¤íŠ¸ ë°˜í™˜ |
| U-07-09-2 | ë„ì›€ë§ ë‚´ìš© ê²€ì¦ | /good, /bad, /save, /more, /keyword, /stats, /mute ëª¨ë‘ í¬í•¨ |

---

## í†µí•© í…ŒìŠ¤íŠ¸ (Integration Tests)

### I-07-01: ì›¹í›… ì¸ì¦ (AC8)

| í…ŒìŠ¤íŠ¸ ID | ì‹œë‚˜ë¦¬ì˜¤ | ê¸°ëŒ€ ê²°ê³¼ |
|----------|---------|----------|
| I-07-01-1 | X-Telegram-Bot-Api-Secret-Token ì—†ìŒ | 401 ë°˜í™˜ |
| I-07-01-2 | ì˜ëª»ëœ ì‹œí¬ë¦¿ í† í° | 401 ë°˜í™˜ |
| I-07-01-3 | ì˜¬ë°”ë¥¸ ì‹œí¬ë¦¿ í† í° + /good ë©”ì‹œì§€ | 200 ë°˜í™˜, sendMessage í˜¸ì¶œ |

### I-07-02: /good ëª…ë ¹ì–´ íë¦„ (AC1)

| í…ŒìŠ¤íŠ¸ ID | ì‹œë‚˜ë¦¬ì˜¤ | ê¸°ëŒ€ ê²°ê³¼ |
|----------|---------|----------|
| I-07-02-1 | ì˜¬ë°”ë¥¸ ì¸ì¦ + /good ë©”ì‹œì§€ â†’ Supabase ì •ìƒ | 200, sendMessage('ì¢‹ì•„ìš”' í¬í•¨) í˜¸ì¶œ |
| I-07-02-2 | /good â†’ Supabase ë¸Œë¦¬í•‘ ì—†ìŒ | 200, sendMessage(ì•ˆë‚´ ë©”ì‹œì§€) í˜¸ì¶œ |

### I-07-03: /save N ëª…ë ¹ì–´ íë¦„ (AC3)

| í…ŒìŠ¤íŠ¸ ID | ì‹œë‚˜ë¦¬ì˜¤ | ê¸°ëŒ€ ê²°ê³¼ |
|----------|---------|----------|
| I-07-03-1 | /save 2 â†’ ì˜¤ëŠ˜ ë¸Œë¦¬í•‘ 2ë²ˆ ì•„ì´í…œ ì¡´ì¬ | 200, user_interactions INSERT, sendMessage í˜¸ì¶œ |
| I-07-03-2 | /save â†’ N ì¸ì ì—†ìŒ | 200, sendMessage(ì‚¬ìš©ë²• ì•ˆë‚´) í˜¸ì¶œ |

### I-07-04: callback_query ì²˜ë¦¬

| í…ŒìŠ¤íŠ¸ ID | ì‹œë‚˜ë¦¬ì˜¤ | ê¸°ëŒ€ ê²°ê³¼ |
|----------|---------|----------|
| I-07-04-1 | `like:uuid` ì½œë°± | 200, user_interactions INSERT('ì¢‹ì•„ìš”') |
| I-07-04-2 | `dislike:uuid` ì½œë°± | 200, user_interactions INSERT('ì‹«ì–´ìš”') |
| I-07-04-3 | `save:uuid` ì½œë°± | 200, user_interactions INSERT('ì €ì¥') |
| I-07-04-4 | ì˜ëª»ëœ ì½œë°± í˜•ì‹ | 200, ì²˜ë¦¬ ë¬´ì‹œ |

### I-07-05: /keyword ëª…ë ¹ì–´ íë¦„ (AC5)

| í…ŒìŠ¤íŠ¸ ID | ì‹œë‚˜ë¦¬ì˜¤ | ê¸°ëŒ€ ê²°ê³¼ |
|----------|---------|----------|
| I-07-05-1 | /keyword LLM | 200, interest_profile UPSERT, sendMessage í˜¸ì¶œ |
| I-07-05-2 | /keyword (ì¸ì ì—†ìŒ) | 200, sendMessage(í‚¤ì›Œë“œ ì…ë ¥ ì•ˆë‚´) í˜¸ì¶œ |

### I-07-06: /stats ëª…ë ¹ì–´ íë¦„ (AC6)

| í…ŒìŠ¤íŠ¸ ID | ì‹œë‚˜ë¦¬ì˜¤ | ê¸°ëŒ€ ê²°ê³¼ |
|----------|---------|----------|
| I-07-06-1 | /stats â†’ í†µê³„ ë°ì´í„° ì¡´ì¬ | 200, sendMessage(í†µê³„ í…ìŠ¤íŠ¸) í˜¸ì¶œ |
| I-07-06-2 | /stats â†’ í†µê³„ ì—†ìŒ | 200, sendMessage(í†µê³„ ì—†ìŒ ì•ˆë‚´) í˜¸ì¶œ |

### I-07-07: /mute ëª…ë ¹ì–´ íë¦„ (AC7)

| í…ŒìŠ¤íŠ¸ ID | ì‹œë‚˜ë¦¬ì˜¤ | ê¸°ëŒ€ ê²°ê³¼ |
|----------|---------|----------|
| I-07-07-1 | /mute 3 | 200, alert_settings UPSERT, sendMessage('3ì¼ê°„ ì¤‘ë‹¨') í˜¸ì¶œ |
| I-07-07-2 | /mute â†’ ì¸ì ì—†ìŒ | 200, sendMessage(ì‚¬ìš©ë²• ì•ˆë‚´) í˜¸ì¶œ |

---

## ëª¨í‚¹ ì „ëµ

1. **Supabase í´ë¼ì´ì–¸íŠ¸**: `vi.mock('@/lib/supabase/server')` â€” ì²´ì¸ ë°©ì‹ ëª¨í‚¹
2. **í…”ë ˆê·¸ë¨ sendMessage**: `vi.mock('@/lib/telegram')` â€” sendMessageë¥¼ vi.fn()ìœ¼ë¡œ êµì²´
3. **ë‚ ì§œ ê³ ì •**: `vi.setSystemTime(new Date('2026-02-28T07:00:00+09:00'))`
4. **í™˜ê²½ë³€ìˆ˜**: `process.env.TELEGRAM_WEBHOOK_SECRET`, `NEXT_PUBLIC_APP_URL` ì„¤ì •

---

*F-07 Test Spec v1.0 | 2026-02-28*
